#!/bin/bash

set -eu

THIS_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
cd "${THIS_DIR}/.."

TMPFILE="$(mktemp)"

bazel query 'kind(md_library, ...)' | LC_ALL=C sort >"${TMPFILE}"

OUTFILE='.dynamic_group_contents/contents.bzl'

cat >"${OUTFILE}" <<EOF
"""Auto-generated bzl file."""

_CONTENTS = [
EOF

while read -r line; do
    echo "    \"${line}\"," >>"${OUTFILE}"
done <"${TMPFILE}"

cat >>"${OUTFILE}" <<EOF
]

def contents():
    return _CONTENTS
EOF

rm "${TMPFILE}"
